AWSTemplateFormatVersion: '2010-09-09'
Description: Create an S3 bucket and EC2 instance via Jenkins
 
Parameters:
  EC2KeyName:
    Type: AWS::EC2::KeyPair::KeyName
    Description: Name of existing EC2 KeyPair
 
Resources:
  MyBucket:
    Type: AWS::S3::Bucket
    Properties:
      BucketName: !Sub '${AWS::StackName}-bucket'
 
  MyEC2:
    Type: AWS::EC2::Instance
    Properties:
      InstanceType: t3.micro
      KeyName: !Ref EC2KeyName
      ImageId: ami-0abcdef1234567890  # replace with a valid region-specific AMI
      Tags:
        - Key: Name
          Value: !Sub '${AWS::StackName}-ec2'
